<!DOCTYPE html>
<html>
<head>
    <title>ë°”ë‚˜ë‚˜ íˆì–´ë¡œ - ë¯¸ë‹ˆ ê²Œì„ ì—”ì§„</title>
    <style>
        body { 
            margin: 0; 
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        #gameWrapper {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        canvas { 
            display: block;
            cursor: pointer;
        }
        #gameInfo {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="gameWrapper">
        <div id="gameInfo">
            <div>ğŸ® ë°”ë‚˜ë‚˜ íˆì–´ë¡œì˜ ëª¨í—˜</div>
            <div id="score">ì ìˆ˜: 0</div>
        </div>
        <canvas id="game"></canvas>
    </div>
    
    <div class="debug" id="debug" style="display: none;">
        <div>FPS: <span id="fps">0</span></div>
        <div>Objects: <span id="objects">0</span></div>
        <div>Hero: <span id="heroPos">0, 0</span></div>
    </div>

    <script>
        // ğŸ® ë¯¸ë‹ˆ ê²Œì„ ì—”ì§„
        class GameEngine {
            constructor(canvasId, width = 800, height = 400) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = width;
                this.canvas.height = height;
                
                this.gameObjects = [];
                this.keys = {};
                this.lastTime = 0;
                this.deltaTime = 0;
                this.fps = 0;
                this.frameCount = 0;
                this.isRunning = true;
                
                this.setupEvents();
                console.log("ğŸ® ê²Œì„ ì—”ì§„ ì‹œì‘!");
            }
            
            setupEvents() {
                // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key] = true;
                    this.onKeyDown(e.key);
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key] = false;
                });
                
                // ë””ë²„ê·¸ ëª¨ë“œ í† ê¸€ (Dí‚¤)
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'd' || e.key === 'D') {
                        const debug = document.getElementById('debug');
                        debug.style.display = debug.style.display === 'none' ? 'block' : 'none';
                    }
                });
            }
            
            // ì˜¤ë²„ë¼ì´ë“œí•  ë©”ì„œë“œë“¤
            onKeyDown(key) {}
            update(deltaTime) {}
            draw() {}
            
            // ê²Œì„ ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬
            addObject(obj) {
                this.gameObjects.push(obj);
                return obj;
            }
            
            removeObject(obj) {
                const index = this.gameObjects.indexOf(obj);
                if (index > -1) {
                    this.gameObjects.splice(index, 1);
                }
            }
            
            // ì¶©ëŒ ê°ì§€
            checkCollision(obj1, obj2) {
                return obj1.x < obj2.x + obj2.width &&
                       obj1.x + obj1.width > obj2.x &&
                       obj1.y < obj2.y + obj2.height &&
                       obj1.y + obj1.height > obj2.y;
            }
            
            // ë©”ì¸ ê²Œì„ ë£¨í”„
            gameLoop(currentTime) {
                // Delta time ê³„ì‚°
                this.deltaTime = (currentTime - this.lastTime) / 1000;
                this.lastTime = currentTime;
                
                // FPS ê³„ì‚°
                this.frameCount++;
                if (this.frameCount % 60 === 0) {
                    this.fps = Math.round(1 / this.deltaTime);
                    document.getElementById('fps').textContent = this.fps;
                }
                
                if (this.isRunning) {
                    // ê²Œì„ ì—…ë°ì´íŠ¸
                    this.update(this.deltaTime);
                    
                    // ëª¨ë“  ì˜¤ë¸Œì íŠ¸ ì—…ë°ì´íŠ¸
                    this.gameObjects.forEach(obj => {
                        if (obj.update) obj.update(this.deltaTime);
                    });
                    
                    // í™”ë©´ ê·¸ë¦¬ê¸°
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.draw();
                    
                    // ëª¨ë“  ì˜¤ë¸Œì íŠ¸ ê·¸ë¦¬ê¸°
                    this.gameObjects.forEach(obj => {
                        if (obj.draw) obj.draw(this.ctx);
                    });
                }
                
                requestAnimationFrame((time) => this.gameLoop(time));
            }
            
            // ê²Œì„ ì‹œì‘
            start() {
                this.gameLoop(0);
            }
        }
        
        // ğŸ¯ ê²Œì„ ì˜¤ë¸Œì íŠ¸ ê¸°ë³¸ í´ë˜ìŠ¤
        class GameObject {
            constructor(x, y, width, height, color = 'black') {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.velocityX = 0;
                this.velocityY = 0;
            }
            
            update(deltaTime) {
                this.x += this.velocityX * deltaTime * 60;
                this.y += this.velocityY * deltaTime * 60;
            }
            
            draw(ctx) {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }
        
        // ğŸµ ì£¼ì¸ê³µ í´ë˜ìŠ¤
        class Hero extends GameObject {
            constructor(x, y) {
                super(x, y, 50, 50, '#8B4513');
                this.jumpPower = -15;
                this.isJumping = false;
                this.gravity = 0.8;
                this.groundY = y;
            }
            
            update(deltaTime) {
                // ì¤‘ë ¥ ì ìš©
                this.velocityY += this.gravity;
                super.update(deltaTime);
                
                // ë°”ë‹¥ ì²´í¬
                if (this.y > this.groundY) {
                    this.y = this.groundY;
                    this.velocityY = 0;
                    this.isJumping = false;
                }
            }
            
            draw(ctx) {
                // ëª¸í†µ
                super.draw(ctx);
                
                // ì–¼êµ´
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(this.x + 25, this.y + 20, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ëˆˆ
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(this.x + 20, this.y + 15, 3, 0, Math.PI * 2);
                ctx.arc(this.x + 30, this.y + 15, 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            jump() {
                if (!this.isJumping) {
                    this.velocityY = this.jumpPower;
                    this.isJumping = true;
                }
            }
            
            moveLeft(speed = 5) {
                if (this.x > 0) {
                    this.x -= speed;
                }
            }
            
            moveRight(speed = 5, maxX) {
                if (this.x < maxX - this.width) {
                    this.x += speed;
                }
            }
        }
        
        // ğŸŒ ë°”ë‚˜ë‚˜ í´ë˜ìŠ¤
        class Banana extends GameObject {
            constructor(x, y) {
                super(x, y, 20, 10, '#FFFF00');
                this.velocityX = 10;
            }
        }
        
        // ğŸ‘¹ ì  í´ë˜ìŠ¤
        class Enemy extends GameObject {
            constructor(x, y) {
                super(x, y, 40, 50, '#FF0000');
                this.velocityX = -3;
                this.isSlipping = false;
            }
            
            slip() {
                this.isSlipping = true;
                this.color = '#FFA500';
                this.velocityX = 5;
            }
        }
        
        // ğŸ® ì‹¤ì œ ê²Œì„ êµ¬í˜„
        class BananaHeroGame extends GameEngine {
            constructor() {
                super('game');
                
                this.hero = new Hero(100, 300);
                this.bananas = [];
                this.enemies = [];
                this.score = 0;
                this.gameOver = false;
                this.enemySpawnTimer = 0;
                
                this.addObject(this.hero);
                
                // ë°°ê²½ ìš”ì†Œë“¤
                this.setupBackground();
            }
            
            setupBackground() {
                // êµ¬ë¦„ë“¤
                this.clouds = [
                    { x: 100, y: 50, width: 60, height: 30 },
                    { x: 300, y: 80, width: 80, height: 40 },
                    { x: 600, y: 60, width: 70, height: 35 }
                ];
            }
            
            onKeyDown(key) {
                if (key === 'z' || key === 'Z') {
                    this.shootBanana();
                }
                
                if ((key === 'r' || key === 'R') && this.gameOver) {
                    this.restart();
                }
            }
            
            update(deltaTime) {
                if (this.gameOver) return;
                
                // ì£¼ì¸ê³µ ì»¨íŠ¸ë¡¤
                if (this.keys['ArrowLeft']) {
                    this.hero.moveLeft();
                }
                if (this.keys['ArrowRight']) {
                    this.hero.moveRight(5, this.canvas.width);
                }
                if (this.keys[' ']) {
                    this.hero.jump();
                }
                
                // ì  ìƒì„± (3ì´ˆë§ˆë‹¤)
                this.enemySpawnTimer += deltaTime;
                if (this.enemySpawnTimer > 3) {
                    this.spawnEnemy();
                    this.enemySpawnTimer = 0;
                }
                
                // ì¶©ëŒ ì²´í¬
                this.checkAllCollisions();
                
                // í™”ë©´ ë°– ì˜¤ë¸Œì íŠ¸ ì œê±°
                this.cleanupObjects();
                
                // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('objects').textContent = this.gameObjects.length;
                document.getElementById('heroPos').textContent = `${Math.round(this.hero.x)}, ${Math.round(this.hero.y)}`;
            }
            
            draw() {
                // ë°°ê²½
                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // êµ¬ë¦„
                this.ctx.fillStyle = 'white';
                this.clouds.forEach(cloud => {
                    this.ctx.fillRect(cloud.x, cloud.y, cloud.width, cloud.height);
                });
                
                // ë•…
                this.ctx.fillStyle = '#8FBC8F';
                this.ctx.fillRect(0, 350, this.canvas.width, 50);
                
                // ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€
                if (this.gameOver) {
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                    
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '48px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('GAME OVER', this.canvas.width / 2, this.canvas.height / 2);
                    
                    this.ctx.font = '24px Arial';
                    this.ctx.fillText('Rí‚¤ë¥¼ ëˆŒëŸ¬ ì¬ì‹œì‘', this.canvas.width / 2, this.canvas.height / 2 + 50);
                }
            }
            
            shootBanana() {
                const banana = new Banana(this.hero.x + this.hero.width, this.hero.y + 25);
                this.bananas.push(banana);
                this.addObject(banana);
                console.log("ğŸŒ ë°”ë‚˜ë‚˜ ë°œì‚¬!");
            }
            
            spawnEnemy() {
                const enemy = new Enemy(this.canvas.width, 300);
                this.enemies.push(enemy);
                this.addObject(enemy);
            }
            
            checkAllCollisions() {
                // ë°”ë‚˜ë‚˜ì™€ ì  ì¶©ëŒ
                this.bananas.forEach((banana, bIndex) => {
                    this.enemies.forEach((enemy, eIndex) => {
                        if (!enemy.isSlipping && this.checkCollision(banana, enemy)) {
                            enemy.slip();
                            this.removeObject(banana);
                            this.bananas.splice(bIndex, 1);
                            this.score += 10;
                            document.getElementById('score').textContent = `ì ìˆ˜: ${this.score}`;
                            
                            // 1ì´ˆ í›„ ì  ì œê±°
                            setTimeout(() => {
                                this.removeObject(enemy);
                                const index = this.enemies.indexOf(enemy);
                                if (index > -1) this.enemies.splice(index, 1);
                            }, 1000);
                        }
                    });
                });
                
                // ì£¼ì¸ê³µê³¼ ì  ì¶©ëŒ
                this.enemies.forEach(enemy => {
                    if (!enemy.isSlipping && this.checkCollision(this.hero, enemy)) {
                        this.gameOver = true;
                        this.isRunning = false;
                    }
                });
            }
            
            cleanupObjects() {
                // í™”ë©´ ë°– ë°”ë‚˜ë‚˜ ì œê±°
                this.bananas = this.bananas.filter(banana => {
                    if (banana.x > this.canvas.width) {
                        this.removeObject(banana);
                        return false;
                    }
                    return true;
                });
                
                // í™”ë©´ ë°– ì  ì œê±°
                this.enemies = this.enemies.filter(enemy => {
                    if (enemy.x < -enemy.width || enemy.x > this.canvas.width) {
                        this.removeObject(enemy);
                        return false;
                    }
                    return true;
                });
            }
            
            restart() {
                this.gameObjects = [];
                this.hero = new Hero(100, 300);
                this.addObject(this.hero);
                this.bananas = [];
                this.enemies = [];
                this.score = 0;
                this.gameOver = false;
                this.isRunning = true;
                this.enemySpawnTimer = 0;
                document.getElementById('score').textContent = 'ì ìˆ˜: 0';
            }
        }
        
        // ğŸš€ ê²Œì„ ì‹œì‘!
        const game = new BananaHeroGame();
        game.start();
    </script>
</body>
</html>